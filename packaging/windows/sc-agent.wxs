<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package Name="Aikido SC-Agent"
           Manufacturer="Aikido Security"
           Version="$(var.Version)"
           ProductCode="5d8fd7e2-55b5-4fc4-82b2-de8ee83f0061"
           UpgradeCode="adb9d7b9-de00-4953-af0e-9c1e9ec15c81"
           Scope="perMachine">

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    
    <Media Id="1" Cabinet="sc-agent.cab" EmbedCab="yes" />

    <!-- Define installation directory structure -->
    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLDIR" Name="AikidoSecurity">
        <Directory Id="AGENTDIR" Name="sc-agent">
          <Directory Id="BINDIR" Name="bin" />
        </Directory>
      </Directory>
    </StandardDirectory>

    <!-- Main feature -->
    <Feature Id="MainFeature" Title="SC-Agent" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="PathComponent" />
    </Feature>

    <!-- Components -->
    <ComponentGroup Id="ProductComponents" Directory="BINDIR">
      <Component Id="ScAgentExe" Guid="3a2f5c8e-e57f-4ce4-ab7f-fa89e94c48cb">
        <File Id="ScAgentExeFile" Source="$(var.BinDir)\sc-agent.exe" KeyPath="yes" />
      </Component>
      <Component Id="SafeChainExe" Guid="e528ac7f-1342-4b26-b87b-1259c6e35f6c">
        <File Id="SafeChainExeFile" Source="$(var.BinDir)\safe-chain.exe" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Add to PATH -->
    <DirectoryRef Id="BINDIR">
      <Component Id="PathComponent" Guid="5809b6b6-57a0-4c2a-9d55-7b274ceb916a">
        <Environment Id="PATH" Name="PATH" Value="[BINDIR]" Permanent="no" Part="last" Action="set" System="yes" />
      </Component>
    </DirectoryRef>

    <!-- UI with license -->
    <WixVariable Id="WixUILicenseRtf" Value="$(var.ProjectDir)\packaging\windows\license.rtf" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
    <ui:WixUI Id="WixUI_InstallDir" />

  </Package>
</Wix>
